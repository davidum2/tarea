<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="980" height="320" viewBox="0 0 980 320">
  <style>
    .box { fill:#ECFEFF; stroke:#06B6D4; stroke-width:2; rx:10; }
    .text { font-family: Inter, Arial, sans-serif; font-size:14px; fill:#0f172a; }
    .arrow { stroke:#06B6D4; stroke-width:2; fill:none; marker-end: url(#arrowhead); }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#06B6D4" />
    </marker>
  </defs>

  <!-- Boxes row 1 -->
  <rect x="20" y="30" width="220" height="70" class="box" />
  <text x="130" y="65" text-anchor="middle" class="text">Webhook (Frontend)</text>

  <rect x="260" y="20" width="180" height="90" class="box" />
  <text x="350" y="50" text-anchor="middle" class="text">Code (Validador)</text>

  <rect x="460" y="20" width="220" height="90" class="box" />
  <text x="570" y="50" text-anchor="middle" class="text">PreparadorQuery → Embeddings</text>

  <rect x="700" y="20" width="220" height="90" class="box" />
  <text x="810" y="50" text-anchor="middle" class="text">Qdrant (Get Many)</text>

  <!-- Boxes row 2 -->
  <rect x="260" y="150" width="220" height="80" class="box" />
  <text x="370" y="190" text-anchor="middle" class="text">Code (FormateadorContexto)</text>

  <rect x="520" y="150" width="220" height="80" class="box" />
  <text x="630" y="190" text-anchor="middle" class="text">Google Gemini (LLM)</text>

  <rect x="760" y="150" width="160" height="80" class="box" />
  <text x="840" y="190" text-anchor="middle" class="text">Code (Validador Calidad)</text>

  <!-- Final Respond -->
  <path d="M880 190 L930 190" class="arrow" />
  <rect x="930" y="160" width="40" height="60" class="box" />
  <text x="950" y="190" text-anchor="middle" class="text">Respond</text>

  <!-- Arrows row 1 -->
  <path d="M240 65 L260 65" class="arrow" />
  <path d="M440 65 L460 65" class="arrow" />
  <path d="M680 65 L700 65" class="arrow" />
  <path d="M580 110 L580 150" class="arrow" />
  <path d="M740 110 L740 150" class="arrow" />
  <path d="M740 190 L760 190" class="arrow" />
  <path d="M740 190 L760 190" class="arrow" />
  <path d="M740 190 L760 190" class="arrow" />

  <!-- Footer note -->
  <text x="490" y="300" text-anchor="middle" class="text" font-size="12" fill="#475569">Flujo 2 — RAG en Vivo: Webhook → Qdrant (búsqueda híbrida) → LLM → Validación → Respond</text>
</svg>